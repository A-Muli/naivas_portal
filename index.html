<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Naivas Portal - Dashboard</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f4f6f8;
    color: #333;
  }
  header { background: #000; padding: 0.8rem 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000;}
  .header-container { display: flex; align-items: center; justify-content: space-between; }
  .logo img { height: 45px; }
  .nav-right { display: flex; align-items: center; gap: 2rem; }
  nav ul { list-style: none; display: flex; gap: 1.5rem; margin: 0; padding: 0; }
  nav ul li a { text-decoration: none; color: white; font-weight: bold; font-size: 1rem; transition: color 0.3s; }
  nav ul li a:hover { color: #f58220; }
  .logout-btn { background: #f58220; color: white; border: none; border-radius: 6px; padding: 0.6rem 1rem; font-weight: 600; cursor: pointer; transition: background 0.3s; }
  .logout-btn:hover { background: #4bb300; }
  .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
  .welcome { background: linear-gradient(to right, #f58220, #4bb300); color: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
  .welcome h2 { margin: 0; font-size: 1.8rem; }
  .booking-section { margin-top: 2rem; background: white; border-radius: 12px; padding: 2rem; text-align: center; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
  .book-btn { background: #f58220; color: white; border: none; border-radius: 6px; padding: 1rem 2rem; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background 0.3s; }
  .book-btn:hover { background: #4bb300; }
  .activations { margin-top: 2rem; }
  .cards { display: flex; flex-wrap: wrap; gap: 1.5rem; margin-top: 1rem; }
  .card { flex: 1; min-width: 280px; background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 3px 6px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: transform 0.2s; }
  .card:hover { transform: scale(1.03); }
  .approved { border-left: 6px solid #4bb300; }
  .pending { border-left: 6px solid #f58220; }
  .rejected { border-left: 6px solid #e74c3c; }
  .ba-section { margin-top: 3rem; background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 3px 6px rgba(0,0,0,0.08); }
  table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
  th, td { border: 1px solid #ddd; padding: 0.8rem; text-align: center; }
  th { background: #4bb300; color: white; }
  tr:nth-child(even) { background: #f9f9f9; }
  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 2000; }
  .modal-content { background: white; width: 90%; max-width: 800px; border-radius: 10px; padding: 2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: fadeIn 0.3s ease-in-out; }
  @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f58220; padding-bottom: 0.5rem; }
  .modal-header h3 { margin: 0; color: #000; }
  .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #f58220; }
</style>
</head>
<body>

<header>
  <div class="header-container">
    <div class="logo"><img src="images/logo.png" alt="Naivas Logo"></div>
    <div class="nav-right">
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="categories.html">Categories</a></li>
          <li><a href="profile.html">Profile</a></li>
        </ul>
      </nav>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
  </div>
</header>

<div class="container">
  <section class="welcome">
    <h2>Welcome back, <span id="userName">User</span> ðŸ‘‹</h2>
    <p><strong>Company:</strong> <span id="companyName">-</span></p>
    <p><strong>Email:</strong> <span id="email">-</span></p>
  </section>

  <section class="booking-section">
    <h3>Ready to book your next activation?</h3>
    <button class="book-btn" onclick="window.location.href='booking.html'">Book Activation</button>
  </section>

  <section class="activations">
    <h3>My Activations Overview</h3>
    <div class="cards">
      <div class="card approved" id="approvedCard">
        <h4>Approved Activations</h4>
        <p id="approvedCount">0</p>
      </div>
      <div class="card pending" id="pendingCard">
        <h4>Pending Activations</h4>
        <p id="pendingCount">0</p>
      </div>
      <div class="card rejected" id="rejectedCard">
        <h4>Rejected Activations</h4>
        <p id="rejectedCount">0</p>
      </div>
    </div>
  </section>

  <section class="ba-section">
    <h3>My Brand Ambassadors</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th><th>ID Number</th><th>Phone</th><th>Status</th>
        </tr>
      </thead>
      <tbody id="baTable"><tr><td colspan="4">Loading...</td></tr></tbody>
    </table>
  </section>
</div>

<div class="modal" id="activationModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Activations</h3>
      <button class="close-btn" id="closeModal">&times;</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Store Name</th><th>Product Category</th><th>Product Type</th><th>Product Name</th><th>Activation Date</th>
        </tr>
      </thead>
      <tbody id="activationDetails"><tr><td colspan="5">Loading...</td></tr></tbody>
    </table>
  </div>
</div>

<script>
const user = JSON.parse(localStorage.getItem("loggedInUser"));
if (!user) {
  alert("Please log in first!");
  window.location.href = "signin.html";
} else {
  document.getElementById("userName").textContent = user.SupplierName || "User";
  document.getElementById("companyName").textContent = user.CompanyName || "Not provided";
  document.getElementById("email").textContent = user.email || "-";
}

document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.clear();
  window.location.href = "signin.html";
});

let activations = [];

async function loadActivations() {
  try {
    const res = await fetch("http://localhost/naivas_portal/backend/get_activations.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: user.email })
    });
    const resData = await res.json();
    if (!resData.success || !Array.isArray(resData.data)) {
      console.error("No activations found");
      return;
    }
    activations = resData.data;

    const approved = activations.filter(a => a.status.toLowerCase() === "approved");
    const pending = activations.filter(a => a.status.toLowerCase() === "pending");
    const rejected = activations.filter(a => a.status.toLowerCase() === "rejected");

    document.getElementById("approvedCount").textContent = approved.length;
    document.getElementById("pendingCount").textContent = pending.length;
    document.getElementById("rejectedCount").textContent = rejected.length;
  } catch (err) {
    console.error("Error loading activations:", err);
  }
}

const modal = document.getElementById("activationModal");
document.getElementById("closeModal").onclick = () => modal.style.display = "none";
window.onclick = e => { if (e.target === modal) modal.style.display = "none"; };

function openModal(status) {
  const filtered = activations.filter(a => a.status.toLowerCase() === status);
  const titleMap = { approved: "Approved Activations", pending: "Pending Activations", rejected: "Rejected Activations" };
  document.getElementById("modalTitle").textContent = titleMap[status];
  const tbody = document.getElementById("activationDetails");
  tbody.innerHTML = "";

  if (!filtered.length) {
    tbody.innerHTML = `<tr><td colspan="5">No ${status} activations found.</td></tr>`;
  } else {
    filtered.forEach(act => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${act.storeName}</td>
        <td>${act.productCategory}</td>
        <td>${act.productType}</td>
        <td>${act.productName}</td>
        <td>${act.activationDate}</td>
      `;
      tbody.appendChild(tr);
    });
  }
  modal.style.display = "flex";
}

document.getElementById("approvedCard").onclick = () => openModal("approved");
document.getElementById("pendingCard").onclick = () => openModal("pending");
document.getElementById("rejectedCard").onclick = () => openModal("rejected");

async function loadBAs() {
  try {
    const res = await fetch("http://localhost/naivas_portal/backend/getBAs.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: user.email })
    });
    const response = await res.json();
    const tbody = document.getElementById("baTable");
    tbody.innerHTML = "";

    if (!response.success || !Array.isArray(response.data) || response.data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4">No BAs found.</td></tr>';
      return;
    }

    response.data.forEach(ba => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${ba.name}</td>
        <td>${ba.idNumber}</td>
        <td>${ba.phoneNumber}</td>
        <td>${ba.status}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error("Error loading BAs:", err);
    document.getElementById("baTable").innerHTML =
      '<tr><td colspan="4" style="color:red;">Error loading data</td></tr>';
  }
}

document.addEventListener("DOMContentLoaded", () => {
  loadActivations();
  loadBAs();
});
</script>

</body>
</html>